<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Architectural Immersive Lab</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
 background:#000;
 color:#fff;
 font-family:system-ui,-apple-system,sans-serif;
 overflow-x:hidden;
}

canvas{
 position:fixed;
 inset:0;
 z-index:-2;
}

video{
 position:fixed;
 inset:0;
 object-fit:cover;
 width:100%;
 height:100%;
 z-index:-3;
 filter:brightness(0.6);
}

.scroll{
 height:1400vh;
}

.overlay{
 position:fixed;
 inset:0;
 display:flex;
 align-items:center;
 justify-content:center;
 text-align:center;
 padding:8vw;
 pointer-events:none;
}

.overlay h1{
 font-size:clamp(2rem,6vw,4.5rem);
 letter-spacing:-0.03em;
}

.overlay p{
 margin-top:20px;
 opacity:.8;
 max-width:600px;
 line-height:1.6;
}

.grain{
 position:fixed;
 inset:-50%;
 background-image:url("https://grainy-gradients.vercel.app/noise.svg");
 opacity:0.2;
 mix-blend-mode:overlay;
 pointer-events:none;
 animation:grain 1s steps(2) infinite;
 z-index:2;
}

@keyframes grain{
 0%,100%{transform:translate(0,0)}
 25%{transform:translate(-5%,5%)}
 50%{transform:translate(5%,-5%)}
 75%{transform:translate(-5%,-5%)}
}
</style>
</head>
<body>

<div class="scroll"></div>

<!-- VIDEO PUBLICO -->
<video autoplay muted loop playsinline>
 <source src="https://cdn.coverr.co/videos/coverr-modern-architecture-6170/1080p.mp4" type="video/mp4">
</video>

<canvas id="webgl"></canvas>

<div class="grain"></div>

<div class="overlay" id="textLayer">
 <div>
   <h1>Arquitetura como Narrativa</h1>
   <p>Espaço, profundidade e transição sensorial guiada pelo scroll.</p>
 </div>
</div>

<!-- AUDIO PUBLICO -->
<audio id="ambient" loop>
 <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_6a81ec7cfa.mp3?filename=ambient-110397.mp3">
</audio>

<script type="module">

import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.152/build/three.module.js"
import { GLTFLoader } from "https://cdn.jsdelivr.net/npm/three@0.152/examples/jsm/loaders/GLTFLoader.js"

/* SCROLL FÍSICO */

let target=0,current=0
const maxScroll=document.body.scrollHeight-innerHeight

addEventListener("scroll",()=>{
 target=scrollY/maxScroll
})

function updateScroll(){
 current+=(target-current)*0.06
}

/* AUDIO CONTROL */

const audio=document.getElementById("ambient")
document.body.addEventListener("click",()=>{
 audio.play()
})

/* THREE SETUP */

const canvas=document.getElementById("webgl")
const renderer=new THREE.WebGLRenderer({canvas,antialias:true})
renderer.setSize(innerWidth,innerHeight)
renderer.setPixelRatio(Math.min(2,devicePixelRatio))

const scene=new THREE.Scene()
const camera=new THREE.PerspectiveCamera(65,innerWidth/innerHeight,.1,200)
camera.position.z=8

const light=new THREE.PointLight(0xffffff,2)
light.position.set(5,5,5)
scene.add(light)

/* PARTICULAS */

const pGeo=new THREE.BufferGeometry()
const count=3000
const pos=new Float32Array(count*3)

for(let i=0;i<count;i++){
 pos[i*3]=(Math.random()-0.5)*40
 pos[i*3+1]=(Math.random()-0.5)*40
 pos[i*3+2]=(Math.random()-0.5)*40
}
pGeo.setAttribute("position",new THREE.BufferAttribute(pos,3))

const pMat=new THREE.PointsMaterial({
 size:0.05,
 color:0xffffff
})

const particles=new THREE.Points(pGeo,pMat)
scene.add(particles)

/* RAYMARCH PLANE */

const rmGeo=new THREE.PlaneGeometry(80,80)
const rmMat=new THREE.ShaderMaterial({
 uniforms:{
  u_time:{value:0},
  u_progress:{value:0}
 },
 vertexShader:`
  varying vec2 vUv;
  void main(){
   vUv=uv;
   gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);
  }
 `,
 fragmentShader:`
  uniform float u_time;
  uniform float u_progress;
  varying vec2 vUv;

  float box(vec3 p,vec3 b){
   vec3 q=abs(p)-b;
   return length(max(q,0.0))+min(max(q.x,max(q.y,q.z)),0.0);
  }

  void main(){
   vec2 uv=vUv*2.-1.;
   vec3 ro=vec3(0.,0.,5.);
   vec3 rd=normalize(vec3(uv,-1.));
   float t=0.;
   float d;
   for(int i=0;i<60;i++){
    vec3 p=ro+rd*t;
    d=box(p,vec3(1.+u_progress*2.));
    if(d<0.001) break;
    t+=d;
   }
   float shade=exp(-t*0.15);
   gl_FragColor=vec4(vec3(shade),0.35*u_progress);
  }
 `,
 transparent:true
})

const rmMesh=new THREE.Mesh(rmGeo,rmMat)
rmMesh.position.z=-20
scene.add(rmMesh)

/* GLTF ARQUITETURA PUBLICA */

const loader=new GLTFLoader()

loader.load(
 "https://modelviewer.dev/shared-assets/models/Astronaut.glb",
 gltf=>{
   const model=gltf.scene
   model.scale.set(2,2,2)
   model.position.y=-2
   scene.add(model)
 }
)

/* ANIMATION LOOP */

function animate(){
 requestAnimationFrame(animate)

 updateScroll()

 camera.position.z=8+current*40
 camera.rotation.z=current*0.5

 particles.rotation.y+=0.001

 rmMat.uniforms.u_time.value+=0.02
 rmMat.uniforms.u_progress.value=current

 renderer.render(scene,camera)

 document.getElementById("textLayer").style.opacity=1-current*1.2

 audio.volume=current
}

animate()

addEventListener("resize",()=>{
 renderer.setSize(innerWidth,innerHeight)
 camera.aspect=innerWidth/innerHeight
 camera.updateProjectionMatrix()
})

</script>
</body>
</html>